default(parisize, "60M");

{
elldata= Map([
  \\ rank 0
  "11a1",[0,-1,1,-10,-20];
  "14a1",[1,0,1,4,-6];
  "15a1",[1,1,1,-10,-10];
  "17a1",[1,-1,1,-1,-14];
  "19a1",[0,1,1,-9,-15];
  "26b1",[1,-1,1,-3,3];
  "43a1",[0,1,1,0,0];
  \\ rank 1
  "37a1",[0,0,1,-1,0];
  "53a1",[1,-1,1,0,0];
  \\ rank 2
  "389a1",[0,1,1,-2,0]
]);
}
myellinit(s)= ellinit(if(type(s)=="t_STR",mapget(elldata,s),s));

\\ a2 = 0
e=myellinit("19a1");
ellpadicL(e, 2, 5)

\\ a3 = 0
e=myellinit("17a1");p=3;
L=ellpadicL(e,p,4)
F=[0,-p;1,ellap(e,p)];
(1-p^{-1}*F)^-2*L / bestappr(ellL1(e)/e.omega[1])

\\ a5 = -2
p=5;
L=ellpadicL(e,p,4)
al=polrootspadic(x^2-ellap(e,p)*x+p,p,7)[2];
(1-al^(-1))^(-2)*L / bestappr(ellL1(e)/e.omega[1])

\\ a3 = -3 != 0
e=myellinit("26b1");p=3;
L=ellpadicL(e,p,4);
F=[0,-p;1,ellap(e,p)];
(1-p^{-1}*F)^-2*L / bestappr(ellL1(e)/e.omega[1])

\\ huge memory 1001a1
e=ellinit([0,-1,1,-15881,778423]);p=2;n=3;
ellpadicL(e,p,n)

E=myellinit("53a1");P=[0,0];
ellpadicL(E,2,10,,2)
ellpadicL(E,3,10)
ellpadicL(E,3,10,,1)
ellpadicL(E,5,5,,2)

testord(s, p, n, D = 1) =
{
  my(e = myellinit(s));
  my([M,xp] = msfromell(e,1));
  Wp = mspadicinit(M, p, n, 0);
  mspadicmoments(Wp, xp, D);
}
testss(s, p, n) =
{
  my(e = myellinit(s));
  my([M,xp] = msfromell(e,1));
  Wp = mspadicinit(M, p, n);
  mspadicmoments(Wp,xp);
}

testord("11a1", 7, 4)
testord("17a1", 7, 4)
testss("17a1", 3, 4)
testord("14a1", 7, 4)
testord("43a1", 3, 4, 29)

e=myellinit("11a1");
[M,phi]=msfromell(e,1);
Wp = mspadicinit(M, 3, 4, 0);
mspadicmoments(Wp, phi, 5)
Wp = mspadicinit(M, 5, 4, 0);
mspadicmoments(Wp, phi, -3)

Wp = mspadicinit(M,3,10,0);
mu=mspadicmoments(Wp,phi);
for(r=0,3, print(mspadicL(mu,0,r)));
for(r=0,3, print(mspadicL(mu,[0,1],r)));

Wp = mspadicinit(M,2,10,1);
mu=mspadicmoments(Wp,phi);
for(r=0,3, print(mspadicL(mu,0,r)));
for(r=0,3, print(mspadicL(mu,[0,1],r)));
for(r=0,3, print(mspadicL(mu,[1,0],r)));
for(r=0,3, print(mspadicL(mu,[2,0],r)));


[M,phi]=msfromell(e,-1);
Wp = mspadicinit(M, 3, 4, 0);
mspadicmoments(Wp, phi, 5)
Wp = mspadicinit(M, 5, 4, 0);
mspadicmoments(Wp, phi, -3)

\\====

W = msinit(50,4,1);
phi = mssplit(W, msnew(W))[1][1][,1];
Wp = mspadicinit(W, 3, 6, 0);
phi = mstooms(Wp, phi);
mspadicmoments(Wp, phi)

M=msinit(4,6,1);
phi=[1,8,1,-32]~;
Wp=mspadicinit(M,3,5);
oms=mspadicmoments(Wp, phi);
mspadicL(oms)
