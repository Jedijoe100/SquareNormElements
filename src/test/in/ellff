test(p,n=0,v='a)=
{
  my(a=if(n,ffgen(ffinit(p,n),v),p));
  my(E=ellffinit([1,3],a));
  my(G=ellgenerators(E)[1]);
  my(P=random(E));
  [d1]=ellgroup(E);
  if(ellorder(E,G)!=d1,error([p,n,0]));
  if(ellpow(E,G,d1)!=[0],error([p,n,1]));
  if(ellpow(E,P,d1)!=[0],error([p,n,2]));
  if(d1%ellorder(E,P)!=0,error([p,n,3]));
  if (d1<10^7,
    P=ellpow(E,G,1023);
    if(elllog(E,P,G)!=1023%d1,error([p,n,4]));
  );
}
test(5,3);
test(7,3);
test(11,2);
test(17,2);
test(1009,3);
test(1013,7);
test(1009,11,'x);
test(17);
test(41);
test(1073741827);
test(nextprime(2^65),3);

a=ffgen(ffinit(101,3),'a);
E=ellffinit([1,a],a); E.j
P=random(E);Q=random(E);
R=elladd(E,P,Q);
elladd(E,ellsub(E,R,P),ellneg(E,Q))
